<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MarSol ¬∑ Control Financiero</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary-dark: #232A39;
  --primary-blue: #4189ED;
  --secondary-blue: #4F60A0;
  --light-blue: #8B97A7;
  --light-gray: #F5F7FA;
  --white: #FFFFFF;
  --success: #34C759;
  --warning: #FF9500;
  --error: #FF3B30;
  --debito-color: #5856D6;
  --credito-color: #FF9500;
  --conjunto-color: #AF52DE;
  --shadow: 0 8px 24px rgba(35, 42, 57, 0.08);
  --shadow-light: 0 4px 12px rgba(35, 42, 57, 0.04);
  --border-radius: 16px;
  --border-radius-sm: 12px;
  --border-radius-lg: 24px;
}
* {box-sizing: border-box; margin: 0; padding: 0; font-family: 'Montserrat', sans-serif;}
body {background: linear-gradient(135deg, #F5F7FA 0%, #E4E7EB 100%); color: var(--primary-dark); min-height: 100vh; padding: 20px; position: relative; transition: all 0.5s ease;}
body.ana-theme {background: linear-gradient(135deg, #FFE6F2 0%, #FFCCE5 100%);}
body.camilo-theme {background: linear-gradient(135deg, #E6F0FF 0%, #C2D1FF 100%);}
body.conjunto-theme {background: linear-gradient(135deg, #F5F7FA 0%, #E4E7EB 100%);}
h1, h2, h3, h4 {font-weight: 600; letter-spacing: -0.02em;}
p, span, small {font-family: 'Inter', sans-serif; font-weight: 400; line-height: 1.5;}
#splash {position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-blue) 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--white); z-index: 9999; transition: opacity 0.5s ease;}
#splash.fade-out {opacity: 0; pointer-events: none;}
.splash-content {text-align: center; animation: fadeInUp 0.8s ease;}
#splash h1 {font-size: 42px; font-weight: 700; margin-bottom: 16px; background: linear-gradient(135deg, #FFFFFF 0%, #E0E7FF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;}
#splash p {font-size: 16px; opacity: 0.9; font-weight: 300;}
#login {display: none; max-width: 480px; margin: 0 auto; padding-top: 60px;}
.login-container {background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: var(--border-radius-lg); padding: 48px; box-shadow: var(--shadow); border: 1px solid rgba(255, 255, 255, 0.2);}
.login-header {text-align: center; margin-bottom: 40px;}
.login-header h2 {font-size: 32px; color: var(--primary-dark); margin-bottom: 8px;}
.login-header p {color: var(--light-blue); font-size: 16px;}
.user-selection {display: grid; gap: 16px; margin-bottom: 32px;}
.user-btn {background: var(--white); border: 2px solid rgba(139, 151, 167, 0.1); border-radius: var(--border-radius); padding: 20px 24px; font-size: 18px; font-weight: 500; color: var(--primary-dark); cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 16px;}
.user-btn:hover {transform: translateY(-2px); border-color: var(--primary-blue); box-shadow: var(--shadow-light);}
.user-btn.selected {color: var(--white); border-color: transparent;}
.user-btn.selected.ana {background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);}
.user-btn.selected.camilo {background: linear-gradient(135deg, var(--error) 0%, #FF375F 100%);}
.user-btn.selected.conjunto {background: linear-gradient(135deg, var(--conjunto-color) 0%, #9B51E0 100%);}
.user-icon {width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;}
.user-btn:not(.selected) .user-icon {background: rgba(139, 151, 167, 0.1);}
#loginMsg {text-align: center; color: var(--error); font-size: 14px; min-height: 20px;}
#app {display: none; max-width: 1200px; margin: 0 auto;}
/* Estilos espec√≠ficos para Ana */
body.ana-theme .app-header,
body.ana-theme .dashboard-card,
body.ana-theme .summary-card,
body.ana-theme .form-card,
body.ana-theme .chart-card,
body.ana-theme .movements-card,
body.ana-theme .modal {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 8px 32px rgba(255, 105, 180, 0.1);
}
body.ana-theme .action-btn,
body.ana-theme .user-btn:not(.selected),
body.ana-theme .segmented-btn:not(.active),
body.ana-theme .filter-btn:not(.active),
body.ana-theme .quick-amount-btn,
body.ana-theme .photo-btn {
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.4);
}
body.ana-theme .view-toggle-btn {
  background: linear-gradient(135deg, rgba(52, 199, 89, 0.8) 0%, rgba(46, 204, 113, 0.8) 100%);
}
body.ana-theme .logout-btn {
  background: rgba(255, 59, 48, 0.8);
}
body.ana-theme .tareas-btn {
  background: linear-gradient(135deg, rgba(255, 149, 0, 0.8) 0%, rgba(255, 159, 10, 0.8) 100%);
}
/* Estilos espec√≠ficos para Camilo */
body.camilo-theme .app-header,
body.camilo-theme .dashboard-card,
body.camilo-theme .summary-card,
body.camilo-theme .form-card,
body.camilo-theme .chart-card,
body.camilo-theme .movements-card,
body.camilo-theme .modal {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.25);
  box-shadow: 0 8px 32px rgba(0, 85, 255, 0.15);
}
body.camilo-theme .action-btn,
body.camilo-theme .user-btn:not(.selected),
body.camilo-theme .segmented-btn:not(.active),
body.camilo-theme .filter-btn:not(.active),
body.camilo-theme .quick-amount-btn,
body.camilo-theme .photo-btn {
  background: rgba(255, 255, 255, 0.75);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.35);
}
body.camilo-theme .view-toggle-btn {
  background: linear-gradient(135deg, rgba(52, 199, 89, 0.85) 0%, rgba(46, 204, 113, 0.85) 100%);
}
body.camilo-theme .logout-btn {
  background: rgba(255, 59, 48, 0.85);
}
body.camilo-theme .tareas-btn {
  background: linear-gradient(135deg, rgba(255, 149, 0, 0.85) 0%, rgba(255, 159, 10, 0.85) 100%);
}
/* Estilos generales de la app */
.app-header {border-radius: var(--border-radius); padding: 20px 24px; margin-bottom: 20px; transition: all 0.3s ease;}
.header-top {display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;}
.welcome-section h3 {font-size: 20px; color: var(--primary-dark); margin-bottom: 6px;}
.user-badges {display: flex; gap: 8px;}
.user-badge {padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px;}
.user-badge.ana {background: rgba(65, 137, 237, 0.1); color: var(--primary-blue);}
.user-badge.camilo {background: rgba(255, 59, 48, 0.1); color: var(--error);}
.user-badge.conjunto {background: rgba(175, 82, 222, 0.1); color: var(--conjunto-color);}
.header-actions {display: flex; gap: 10px;}
.action-btn {padding: 10px 20px; border: none; border-radius: var(--border-radius-sm); font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;}
.action-btn:hover {transform: translateY(-2px); box-shadow: var(--shadow);}
.tareas-btn {background: linear-gradient(135deg, #FF9500 0%, #FF9F0A 100%); color: var(--white);}
.dashboard {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;}
.dashboard-card {border-radius: var(--border-radius); padding: 20px; transition: transform 0.3s ease; display: flex; flex-direction: column;}
.dashboard-card:hover {transform: translateY(-3px);}
.card-header {display: flex; align-items: center; gap: 10px; margin-bottom: 12px;}
.card-icon {width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;}
.ingreso .card-icon {background: rgba(52, 199, 89, 0.1); color: var(--success);}
.gasto .card-icon {background: rgba(255, 59, 48, 0.1); color: var(--error);}
.saldo .card-icon {background: rgba(65, 137, 237, 0.1); color: var(--primary-blue);}
.debito .card-icon {background: rgba(88, 86, 214, 0.1); color: var(--debito-color);}
.credito .card-icon {background: rgba(255, 149, 0, 0.1); color: var(--credito-color);}
.card-header span {font-size: 14px; color: var(--light-blue); font-weight: 500;}
.card-amount {font-size: 24px; font-weight: 700; margin-bottom: 4px;}
.card-trend {font-size: 12px; color: var(--light-blue); margin-top: auto;}
.summary-cards {display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;}
.summary-card {border-radius: var(--border-radius); padding: 16px; text-align: center;}
.summary-card h4 {font-size: 13px; color: var(--light-blue); margin-bottom: 8px; font-weight: 500;}
.summary-card .count {font-size: 28px; font-weight: 700; color: var(--primary-dark); margin-bottom: 4px;}
.summary-card .label {font-size: 12px; color: var(--light-blue);}
.content-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;}
.charts-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;}
.form-card {border-radius: var(--border-radius); padding: 28px;}
.form-card h2 {font-size: 20px; margin-bottom: 20px; color: var(--primary-dark);}
.segmented-control {display: flex; background: rgba(139, 151, 167, 0.1); border-radius: var(--border-radius-sm); padding: 4px; margin-bottom: 20px;}
.segmented-btn {flex: 1; padding: 12px; border: none; background: none; border-radius: 10px; font-weight: 600; color: var(--light-blue); cursor: pointer; transition: all 0.3s ease; font-size: 14px;}
.segmented-btn.active {background: var(--white); color: var(--primary-dark); box-shadow: var(--shadow-light);}
.form-group {margin-bottom: 16px;}
.form-label {display: block; margin-bottom: 6px; font-weight: 500; color: var(--primary-dark); font-size: 13px;}
.form-input, .form-select, .form-textarea {width: 100%; padding: 14px; background: rgba(139, 151, 167, 0.05); border: 2px solid rgba(139, 151, 167, 0.1); border-radius: var(--border-radius-sm); font-size: 14px; color: var(--primary-dark); transition: all 0.3s ease; font-family: 'Inter', sans-serif;}
.form-input:focus, .form-select:focus, .form-textarea:focus {outline: none; border-color: var(--primary-blue); background: var(--white);}
.form-textarea {min-height: 100px; resize: vertical;}
.quick-amounts {display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px;}
.quick-amount-btn {padding: 10px; background: rgba(65, 137, 237, 0.1); border: 2px solid rgba(65, 137, 237, 0.2); border-radius: var(--border-radius-sm); color: var(--primary-blue); font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 12px; text-align: center;}
.quick-amount-btn:hover {background: var(--primary-blue); color: var(--white);}
.photo-section {margin-bottom: 20px;}
.photo-btn {width: 100%; padding: 14px; background: rgba(52, 199, 89, 0.1); border: 2px solid rgba(52, 199, 89, 0.2); border-radius: var(--border-radius-sm); color: var(--success); font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease; font-size: 14px;}
.photo-btn:hover {background: var(--success); color: var(--white);}
.photo-preview {width: 100%; height: 180px; border-radius: var(--border-radius-sm); object-fit: cover; margin-top: 14px; display: none; border: 2px solid rgba(139, 151, 167, 0.1);}
.submit-btn {width: 100%; padding: 16px; background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%); border: none; border-radius: var(--border-radius-sm); color: var(--white); font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;}
.submit-btn:hover {transform: translateY(-2px); box-shadow: var(--shadow);}
.chart-card {border-radius: var(--border-radius); padding: 28px;}
.chart-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}
.chart-header h2 {font-size: 20px; color: var(--primary-dark);}
.chart-container {height: 280px; position: relative;}
.movements-card {border-radius: var(--border-radius); padding: 28px; grid-column: 1 / -1;}
.movements-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}
.movements-header h2 {font-size: 20px; color: var(--primary-dark);}
.filter-controls {display: flex; gap: 8px; flex-wrap: wrap;}
.filter-btn {padding: 6px 14px; background: rgba(139, 151, 167, 0.1); border: none; border-radius: 20px; color: var(--light-blue); font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-size: 12px; white-space: nowrap;}
.filter-btn.active {background: var(--primary-blue); color: var(--white);}
.filter-btn.debito {background: rgba(88, 86, 214, 0.1); color: var(--debito-color);}
.filter-btn.debito.active {background: var(--debito-color); color: var(--white);}
.filter-btn.credito {background: rgba(255, 149, 0, 0.1); color: var(--credito-color);}
.filter-btn.credito.active {background: var(--credito-color); color: var(--white);}
.movements-list {max-height: 500px; overflow-y: auto; padding-right: 8px;}
.movement-item {background: rgba(245, 247, 250, 0.5); border-radius: var(--border-radius-sm); padding: 18px; margin-bottom: 10px; border-left: 4px solid transparent; transition: all 0.3s ease;}
.movement-item:hover {transform: translateX(4px); background: var(--white);}
.movement-item.ingreso {border-left-color: var(--success);}
.movement-item.gasto {border-left-color: var(--error);}
.movement-item.movimiento-eliminado {opacity: 0.6; border-left-color: var(--light-blue);}
.movement-header {display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;}
.movement-info h4 {font-size: 16px; margin-bottom: 4px;}
.movement-category {color: var(--light-blue); font-size: 13px;}
.movement-amount {font-size: 18px; font-weight: 700;}
.ingreso .movement-amount {color: var(--success);}
.gasto .movement-amount {color: var(--error);}
.movement-details {display: flex; justify-content: space-between; align-items: center; margin-top: 14px; padding-top: 14px; border-top: 1px solid rgba(139, 151, 167, 0.1);}
.movement-meta {display: flex; gap: 14px; flex-wrap: wrap;}
.movement-date, .movement-user, .movement-fuente {color: var(--light-blue); font-size: 13px;}
.movement-fuente.debito {color: var(--debito-color); font-weight: 500;}
.movement-fuente.credito {color: var(--credito-color); font-weight: 500;}
.movement-actions {display: flex; gap: 6px;}
.action-icon-btn {width: 32px; height: 32px; border-radius: 50%; border: none; background: rgba(139, 151, 167, 0.1); color: var(--light-blue); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; font-size: 14px;}
.action-icon-btn:hover {background: var(--primary-blue); color: var(--white);}
.delete-btn:hover {background: var(--error);}
.restore-btn:hover {background: var(--success);}
.photo-btn-small:hover {background: var(--warning);}
.modal-overlay {position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(35, 42, 57, 0.8); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px;}
.modal {background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); border-radius: var(--border-radius-lg); width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; border: 1px solid rgba(255, 255, 255, 0.2); animation: modalSlideIn 0.3s ease;}
.modal-header {display: flex; justify-content: space-between; align-items: center; padding: 20px 28px; border-bottom: 1px solid rgba(139, 151, 167, 0.1);}
.modal-header h2 {font-size: 20px; color: var(--primary-dark);}
.close-modal {width: 36px; height: 36px; border-radius: 50%; border: none; background: rgba(139, 151, 167, 0.1); color: var(--light-blue); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; font-size: 20px;}
.close-modal:hover {background: var(--error); color: var(--white);}
.modal-body {padding: 28px;}
.notification {position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); border-radius: var(--border-radius-sm); padding: 12px 20px; box-shadow: 0 4px 20px rgba(35, 42, 57, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); z-index: 1000; display: none; align-items: center; gap: 10px; max-width: 320px; width: 90%; animation: slideUpFromBottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; border-top: 3px solid transparent;}
.notification.success {border-top-color: var(--success);}
.notification.error {border-top-color: var(--error);}
.notification.warning {border-top-color: var(--warning);}
.notification-icon {width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0;}
.notification.success .notification-icon {background: rgba(52, 199, 89, 0.1); color: var(--success);}
.notification.error .notification-icon {background: rgba(255, 59, 48, 0.1); color: var(--error);}
.notification.warning .notification-icon {background: rgba(255, 149, 0, 0.1); color: var(--warning);}
.notification-content {flex: 1; min-width: 0;}
.notification-content p {font-weight: 500; font-size: 13px; margin: 0; color: var(--primary-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
.notification-content small {color: var(--light-blue); font-size: 11px; display: block; margin-top: 2px;}
.notification-close {width: 20px; height: 20px; border-radius: 50%; border: none; background: rgba(139, 151, 167, 0.1); color: var(--light-blue); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; font-size: 12px; flex-shrink: 0; margin-left: 5px;}
.notification-close:hover {background: var(--error); color: var(--white);}
/* Estilos para tareas */
.tarea-item {background: rgba(245, 247, 250, 0.5); border-radius: var(--border-radius-sm); padding: 18px; margin-bottom: 10px; border-left: 4px solid transparent; transition: all 0.3s ease; border-left-color: #FF9500;}
.tarea-item.completada {opacity: 0.7; border-left-color: var(--success);}
.tarea-item:hover {transform: translateX(4px); background: var(--white);}
.tarea-header {display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;}
.tarea-info h4 {font-size: 16px; margin-bottom: 4px;}
.tarea-categoria {color: var(--light-blue); font-size: 13px;}
.tarea-prioridad {font-size: 13px; font-weight: 500; padding: 2px 8px; border-radius: 12px; display: inline-block; margin-left: 8px;}
.prioridad-alta {background: rgba(255, 59, 48, 0.1); color: var(--error);}
.prioridad-media {background: rgba(255, 149, 0, 0.1); color: var(--warning);}
.importancia-alta {background: rgba(52, 199, 89, 0.1); color: var(--success);}
.importancia-media {background: rgba(65, 137, 237, 0.1); color: var(--primary-blue);}
.tarea-details {display: flex; justify-content: space-between; align-items: center; margin-top: 14px; padding-top: 14px; border-top: 1px solid rgba(139, 151, 167, 0.1);}
.tarea-meta {display: flex; gap: 14px; flex-wrap: wrap;}
.tarea-fecha {color: var(--light-blue); font-size: 13px;}
.tarea-completada {color: var(--success); font-size: 13px; font-weight: 500;}
.switch-container {display: flex; gap: 20px; margin-bottom: 20px;}
.switch-group {flex: 1;}
.switch-label {font-weight: 500; color: var(--primary-dark); font-size: 13px; margin-bottom: 8px; display: block;}
.switch-buttons {display: flex; background: rgba(139, 151, 167, 0.1); border-radius: var(--border-radius-sm); padding: 4px;}
.switch-btn {flex: 1; padding: 10px; border: none; background: none; border-radius: 8px; font-weight: 600; color: var(--light-blue); cursor: pointer; transition: all 0.3s ease; font-size: 13px;}
.switch-btn.active {background: var(--white); color: var(--primary-dark); box-shadow: var(--shadow-light);}
.urgency-btn.active.alta {background: var(--error); color: var(--white);}
.urgency-btn.active.media {background: var(--warning); color: var(--white);}
.importance-btn.active.alta {background: var(--success); color: var(--white);}
.importance-btn.active.media {background: var(--primary-blue); color: var(--white);}
@keyframes fadeInUp {from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);}}
@keyframes modalSlideIn {from {opacity: 0; transform: translateY(40px) scale(0.95);} to {opacity: 1; transform: translateY(0) scale(1);}}
@keyframes slideUpFromBottom {from {opacity: 0; transform: translateX(-50%) translateY(100px);} to {opacity: 1; transform: translateX(-50%) translateY(0);}}
@keyframes slideDownToBottom {from {opacity: 1; transform: translateX(-50%) translateY(0);} to {opacity: 0; transform: translateX(-50%) translateY(100px);}}
::-webkit-scrollbar {width: 6px;}
::-webkit-scrollbar-track {background: rgba(139, 151, 167, 0.1); border-radius: 4px;}
::-webkit-scrollbar-thumb {background: rgba(139, 151, 167, 0.3); border-radius: 4px;}
::-webkit-scrollbar-thumb:hover {background: rgba(139, 151, 167, 0.5);}
@media (max-width: 1024px) {.content-grid, .charts-grid {grid-template-columns: 1fr;}}
@media (max-width: 768px) {
  .content-grid, .charts-grid {gap: 16px;}
  .dashboard {grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;}
  .summary-cards {grid-template-columns: repeat(2, 1fr); gap: 12px;}
  .dashboard-card, .summary-card {padding: 16px;}
  .summary-card {padding: 12px;}
  .card-amount {font-size: 20px;}
  .summary-card .count {font-size: 22px;}
  .header-actions {flex-direction: column; width: 100%;}
  .action-btn {width: 100%; justify-content: center;}
  .movements-header {flex-direction: column; gap: 12px; align-items: flex-start;}
  .filter-controls {width: 100%; overflow-x: auto; padding-bottom: 6px;}
  .notification {width: 95%; max-width: 280px; padding: 10px 16px;}
  .switch-container {flex-direction: column; gap: 15px;}
  .quick-amounts {grid-template-columns: repeat(2, 1fr);}
}
@media (max-width: 480px) {
  .quick-amounts {grid-template-columns: repeat(3, 1fr);}
  .quick-amount-btn {font-size: 11px; padding: 8px 4px;}
}
</style>
</head>
<body>
<div class="notification" id="notification"><div class="notification-icon" id="notificationIcon">‚úì</div><div class="notification-content"><p id="notificationTitle">¬°√âxito!</p><small id="notificationMessage">Operaci√≥n completada correctamente</small></div><button class="notification-close" onclick="closeNotification()">√ó</button></div>
<div class="modal-overlay" id="cameraModal"><div class="modal"><div class="modal-header"><h2>üì∏ Capturar Factura</h2><button class="close-modal" onclick="closeCameraModal()">√ó</button></div><div class="modal-body"><div class="camera-container"><video id="cameraVideo" autoplay playsinline style="width:100%;border-radius:12px;background:#000"></video><canvas id="cameraCanvas" style="display:none"></canvas><img id="capturedImage" alt="Foto capturada" style="width:100%;border-radius:12px;display:none"><div style="display:flex;gap:15px;margin-top:20px;justify-content:center"><button class="action-btn" style="background:var(--primary-blue)" id="captureBtn" onclick="capturePhoto()">Capturar Foto</button></div><div style="margin-top:20px;display:none;text-align:center" id="photoActions"><button class="action-btn" style="background:var(--light-blue);margin-right:10px" onclick="retakePhoto()">Tomar Otra</button><button class="action-btn" style="background:var(--success)" onclick="usePhoto()">Usar Esta Foto</button></div></div></div></div></div>
<div class="modal-overlay" id="photoViewer"><div class="modal" style="max-width:800px"><div class="modal-header"><h2>üìÑ Factura</h2><button class="close-modal" onclick="closePhotoViewer()">√ó</button></div><div class="modal-body"><img id="fullSizePhoto" alt="Foto completa" style="width:100%;border-radius:var(--border-radius-sm)"></div></div></div>
<div class="modal-overlay" id="tareasModal"><div class="modal" style="max-width:800px"><div class="modal-header"><h2>üìù Tareas Personales</h2><button class="close-modal" onclick="closeTareasModal()">√ó</button></div><div class="modal-body"><div class="form-card" style="box-shadow:none;padding:0;background:none"><h3 style="margin-bottom:20px">Nueva Tarea</h3><form id="tareaForm"><div class="form-group"><label class="form-label">Detalle de la Tarea</label><textarea class="form-textarea" id="tareaDetalle" placeholder="Describe la tarea a realizar..." required style="min-height:80px"></textarea></div><div class="form-group"><label class="form-label">Categor√≠a</label><select class="form-select" id="tareaCategoria" required><option value="">Selecciona categor√≠a</option><option value="laboral">Laboral</option><option value="estudio">Estudio</option><option value="ocio">Ocio</option><option value="diligencias">Diligencias</option></select></div><div class="switch-container"><div class="switch-group"><label class="switch-label">Urgencia</label><div class="switch-buttons"><button type="button" class="switch-btn urgency-btn media active" onclick="setUrgency('media')">Media</button><button type="button" class="switch-btn urgency-btn alta" onclick="setUrgency('alta')">Alta</button></div></div><div class="switch-group"><label class="switch-label">Importancia</label><div class="switch-buttons"><button type="button" class="switch-btn importance-btn media active" onclick="setImportance('media')">Media</button><button type="button" class="switch-btn importance-btn alta" onclick="setImportance('alta')">Alta</button></div></div></div><button class="submit-btn" type="submit" style="margin-top:20px">Agregar Tarea</button></form></div><div class="movements-card" style="margin-top:30px"><div class="movements-header"><h3>Historial de Tareas</h3></div><div class="movements-list" id="listaTareas" style="max-height:400px"><div style="text-align:center;padding:40px;color:var(--light-blue)"><div style="font-size:48px;margin-bottom:16px">üìù</div><h3 style="margin-bottom:8px">No hay tareas registradas</h3><p>Agrega tu primera tarea personal</p></div></div></div></div></div></div>
<div id="splash"><div class="splash-content"><h1>MarSol</h1><p>Sistema de Control Financiero ¬∑ Versi√≥n 1.8</p></div></div>
<div id="login"><div class="login-container"><div class="login-header"><h2>Bienvenido de Nuevo</h2><p>Selecciona tu perfil para continuar</p></div><div class="user-selection"><button class="user-btn" id="btnAna" onclick="loginUser('ana')"><div class="user-icon">üë©</div><div><div style="font-weight:600">Ana Mar√≠a</div><small style="opacity:0.7">Cuenta Personal</small></div></button><button class="user-btn" id="btnCamilo" onclick="loginUser('camilo')"><div class="user-icon">üë®</div><div><div style="font-weight:600">Camilo Andr√©s</div><small style="opacity:0.7">Cuenta Personal</small></div></button><button class="user-btn" id="btnConjunto" onclick="loginUser('conjunto')"><div class="user-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div><div><div style="font-weight:600">Gastos Conjuntos</div><small style="opacity:0.7">Cuenta Compartida</small></div></button></div><p id="loginMsg"></p></div></div>
<div id="app"><header class="app-header"><div class="header-top"><div class="welcome-section"><h3 id="welcomeUser">Bienvenido/a</h3><div class="user-badges" id="userBadges"></div></div><div class="header-actions"><button class="action-btn view-toggle-btn" id="viewToggleBtn" onclick="toggleView()"><span>üë•</span><span id="viewToggleText">Visual Conjunta</span></button><button class="action-btn tareas-btn" id="tareasBtn" onclick="openTareasModal()" style="display:none"><span>üìù</span><span>Tareas Personales</span></button><button class="action-btn logout-btn" onclick="logout()"><span>‚Ü©Ô∏è</span><span>Cerrar Sesi√≥n</span></button></div></div></header><div class="dashboard"><div class="dashboard-card ingreso"><div class="card-header"><div class="card-icon">‚Üë</div><span>INGRESOS</span></div><div class="card-amount" id="totalIngresos">COP 0</div><div class="card-trend" id="totalIngresosCount">0 registros</div></div><div class="dashboard-card gasto"><div class="card-header"><div class="card-icon">‚Üì</div><span>GASTOS</span></div><div class="card-amount" id="totalGastos">COP 0</div><div class="card-trend" id="totalGastosCount">0 registros</div></div><div class="dashboard-card saldo"><div class="card-header"><div class="card-icon">$</div><span>SALDO</span></div><div class="card-amount" id="saldo">COP 0</div><div class="card-trend">Saldo disponible actual</div></div><div class="dashboard-card debito" id="debitoCard" style="display:none"><div class="card-header"><div class="card-icon">üí≥</div><span>GASTOS D√âBITO</span></div><div class="card-amount" id="totalDebito">COP 0</div><div class="card-trend">Gastos con tarjeta d√©bito</div></div><div class="dashboard-card credito" id="creditoCard" style="display:none"><div class="card-header"><div class="card-icon">üí≥</div><span>GASTOS CR√âDITO</span></div><div class="card-amount" id="totalCredito">COP 0</div><div class="card-trend">Gastos con tarjeta cr√©dito</div></div></div><div class="summary-cards"><div class="summary-card"><h4>TOTAL INGRESOS</h4><div class="count" id="summaryIngresosCount">0</div><div class="label">registros</div></div><div class="summary-card"><h4>TOTAL GASTOS</h4><div class="count" id="summaryGastosCount">0</div><div class="label">registros</div></div><div class="summary-card"><h4>GASTOS D√âBITO</h4><div class="count" id="summaryDebitoCount">0</div><div class="label">registros</div></div><div class="summary-card"><h4>GASTOS CR√âDITO</h4><div class="count" id="summaryCreditoCount">0</div><div class="label">registros</div></div></div><div class="content-grid"><div class="form-card"><h2>Registrar Movimiento</h2><div class="segmented-control"><button type="button" class="segmented-btn active" id="btnIngreso">Ingreso</button><button type="button" class="segmented-btn" id="btnGasto">Gasto</button></div><form id="formulario"><div class="form-group"><label class="form-label">Monto (COP)</label><input type="number" class="form-input" id="monto" placeholder="0" required></div><div class="quick-amounts"><button type="button" class="quick-amount-btn" onclick="addAmount(1000)">+1K</button><button type="button" class="quick-amount-btn" onclick="addAmount(2000)">+2K</button><button type="button" class="quick-amount-btn" onclick="addAmount(5000)">+5K</button><button type="button" class="quick-amount-btn" onclick="addAmount(10000)">+10K</button><button type="button" class="quick-amount-btn" onclick="addAmount(20000)">+20K</button><button type="button" class="quick-amount-btn" onclick="addAmount(50000)">+50K</button><button type="button" class="quick-amount-btn" onclick="addAmount(100000)">+100K</button><button type="button" class="quick-amount-btn" onclick="addAmount(200000)">+200K</button></div><div class="form-group"><label class="form-label">Categor√≠a Principal</label><select class="form-select" id="catNivel1" required><option value="">Selecciona categor√≠a principal</option></select></div><div class="form-group"><label class="form-label">Subcategor√≠a</label><select class="form-select" id="catNivel2" required><option value="">Selecciona subcategor√≠a</option></select></div><div class="form-group" id="fuenteSection" style="display:none"><label class="form-label">Fuente del Dinero</label><select class="form-select" id="fuenteDinero"><option value="">Selecciona fuente</option><option value="Debito">üí≥ D√©bito</option><option value="Credito">üí≥ Cr√©dito</option></select></div><div class="form-group" id="photoSection" style="display:none"><label class="form-label">Foto de Factura (Opcional)</label><button type="button" class="photo-btn" id="takePhotoBtn" onclick="openCameraModal()"><span>üì∏</span><span>Tomar Foto</span></button><img id="photoPreview" class="photo-preview" alt="Vista previa de foto"></div><div class="form-group"><label class="form-label">Observaciones</label><textarea class="form-textarea" id="observacion" placeholder="Agrega informaci√≥n adicional..."></textarea></div><button class="submit-btn" type="submit">Registrar Movimiento</button></form></div><div class="chart-card"><div class="chart-header"><h2>Resumen Financiero</h2></div><div class="chart-container"><canvas id="grafico"></canvas></div></div></div><div class="charts-grid"><div class="chart-card"><div class="chart-header"><h2>Distribuci√≥n de Gastos</h2></div><div class="chart-container"><canvas id="graficoGastos"></canvas></div></div><div class="chart-card"><div class="chart-header"><h2>Ingresos Mensuales</h2></div><div class="chart-container"><canvas id="graficoIngresos"></canvas></div></div></div><div class="movements-card"><div class="movements-header"><h2>Movimientos Recientes</h2><div class="filter-controls" id="movementFilters"><button class="filter-btn active" onclick="filterMovements('todos')">Todos</button><button class="filter-btn" onclick="filterMovements('ingresos')">Ingresos</button><button class="filter-btn" onclick="filterMovements('gastos')">Gastos</button><button class="filter-btn" onclick="filterMovements('activos')">Activos</button><button class="filter-btn debito" onclick="filterMovements('debito')">D√©bito</button><button class="filter-btn credito" onclick="filterMovements('credito')">Cr√©dito</button></div></div><div class="movements-list" id="listaMovimientos"><div style="text-align:center;padding:48px;color:var(--light-blue)"><div style="font-size:48px;margin-bottom:16px">üìä</div><h3 style="margin-bottom:8px">No hay movimientos a√∫n</h3><p>Comienza registrando tu primer ingreso o gasto</p></div></div></div></div>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
<script>
// ===== CONFIGURACI√ìN FIREBASE =====
firebase.initializeApp({
  apiKey: "AIzaSyDYD0OBJKdZ14-mvzEpN85M5_glF92WE_g",
  authDomain: "formulario-github.firebaseapp.com",
  projectId: "formulario-github",
  storageBucket: "formulario-github.appspot.com"
});
const db = firebase.firestore();
const storage = firebase.storage();

// ===== VARIABLES GLOBALES =====
let currentUser = null;
let chart = null;
let chartGastos = null;
let chartIngresos = null;
let appInitialized = false;
let isConjuntaView = false;
let unsubscribeListener = null;
let unsubscribeTareasListener = null;
let currentPhotoBlob = null;
let cameraStream = null;
let tipo = "Ingreso";
let notificationTimeout = null;
let currentFilter = 'todos';
let allMovements = [];
let tareaUrgencia = 'media';
let tareaImportancia = 'media';

// ===== FUNCIONES UTILES =====
function showNotification(message, type = 'success', duration = 3000) {
  const notification = document.getElementById('notification');
  const notificationIcon = document.getElementById('notificationIcon');
  const notificationTitle = document.getElementById('notificationTitle');
  const notificationMessage = document.getElementById('notificationMessage');
  
  if (notificationTimeout) {
    clearTimeout(notificationTimeout);
    notificationTimeout = null;
  }
  
  notification.className = `notification ${type}`;
  let icon = "‚úì";
  let title = "¬°√âxito!";
  
  switch(type) {
    case 'success':
      icon = "‚úì";
      title = "¬°√âxito!";
      break;
    case 'error':
      icon = "‚úï";
      title = "¬°Error!";
      break;
    case 'warning':
      icon = "‚ö†";
      title = "¬°Advertencia!";
      break;
  }
  
  notificationIcon.textContent = icon;
  notificationTitle.textContent = title;
  notificationMessage.textContent = message;
  notification.style.display = 'flex';
  notification.style.animation = 'slideUpFromBottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';
  
  notificationTimeout = setTimeout(() => {
    closeNotification();
  }, duration);
}

function closeNotification() {
  const notification = document.getElementById('notification');
  notification.style.animation = 'slideDownToBottom 0.3s ease forwards';
  setTimeout(() => {
    notification.style.display = 'none';
    notification.style.animation = '';
  }, 300);
  if (notificationTimeout) {
    clearTimeout(notificationTimeout);
    notificationTimeout = null;
  }
}

function addAmount(amount) {
  const montoInput = document.getElementById('monto');
  const currentValue = parseInt(montoInput.value) || 0;
  montoInput.value = currentValue + amount;
  montoInput.focus();
}

// ===== MANEJO DEL SPLASH =====
function showSplash() {
  const splash = document.getElementById('splash');
  splash.style.display = 'flex';
  splash.classList.remove('fade-out');
  document.getElementById('login').style.display = 'none';
  document.getElementById('app').style.display = 'none';
  
  setTimeout(() => {
    splash.classList.add('fade-out');
    setTimeout(() => {
      splash.style.display = 'none';
      showLogin();
    }, 500);
  }, 1500);
}

function showLogin() {
  document.getElementById('login').style.display = 'block';
  document.getElementById('app').style.display = 'none';
  document.getElementById('splash').style.display = 'none';
  currentUser = null;
  isConjuntaView = false;
  document.getElementById('loginMsg').textContent = "";
  appInitialized = false;
  
  document.getElementById('btnAna').classList.remove('selected', 'ana');
  document.getElementById('btnCamilo').classList.remove('selected', 'camilo');
  document.getElementById('btnConjunto').classList.remove('selected', 'conjunto');
  
  if (chart) {
    chart.destroy();
    chart = null;
  }
  if (chartGastos) {
    chartGastos.destroy();
    chartGastos = null;
  }
  if (chartIngresos) {
    chartIngresos.destroy();
    chartIngresos = null;
  }
  
  if (unsubscribeListener) {
    unsubscribeListener();
    unsubscribeListener = null;
  }
  if (unsubscribeTareasListener) {
    unsubscribeTareasListener();
    unsubscribeTareasListener = null;
  }
  
  document.body.className = '';
}

// ===== INICIALIZAR SPLASH AL CARGAR LA P√ÅGINA =====
// Ejecutar inmediatamente cuando el script se carga
showSplash();

// ===== AUTENTICACI√ìN =====
const USER_NAMES = {
  ana: "Ana Mar√≠a",
  camilo: "Camilo Andr√©s",
  conjunto: "Gastos Conjuntos"
};

const USER_COLORS = {
  ana: "#007aff",
  camilo: "#ff3b30",
  conjunto: "#AF52DE"
};

function loginUser(user) {
  currentUser = user;
  document.getElementById('btnAna').classList.remove('selected', 'ana');
  document.getElementById('btnCamilo').classList.remove('selected', 'camilo');
  document.getElementById('btnConjunto').classList.remove('selected', 'conjunto');
  
  const btn = document.getElementById(`btn${user.charAt(0).toUpperCase() + user.slice(1)}`);
  btn.classList.add('selected', user);
  
  showNotification(`Ingresando como ${USER_NAMES[user]}`, 'success');
  document.getElementById('login').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('welcomeUser').textContent = `Bienvenido/a, ${USER_NAMES[currentUser]}`;
  updateUserBadges();
  
  if (currentUser === 'camilo') {
    document.getElementById('tareasBtn').style.display = 'flex';
    loadTareas();
  } else {
    document.getElementById('tareasBtn').style.display = 'none';
  }
  
  document.body.className = user + '-theme';
  
  if (!appInitialized) {
    initializeApp();
    appInitialized = true;
  } else {
    loadData();
  }
}

function logout() {
  showNotification("Sesi√≥n cerrada correctamente", 'success');
  showSplash();
}

function toggleView() {
  isConjuntaView = !isConjuntaView;
  const viewToggleBtn = document.getElementById('viewToggleBtn');
  const viewToggleText = document.getElementById('viewToggleText');
  
  if (isConjuntaView) {
    viewToggleText.textContent = "Visual Individual";
    viewToggleBtn.classList.add("conjunta");
    document.getElementById('welcomeUser').textContent = "Visualizaci√≥n Conjunta";
    showNotification("Visualizando datos de todos los usuarios", 'success');
  } else {
    viewToggleText.textContent = "Visual Conjunta";
    viewToggleBtn.classList.remove("conjunta");
    document.getElementById('welcomeUser').textContent = `Bienvenido/a, ${USER_NAMES[currentUser]}`;
    showNotification("Visualizando datos individuales", 'success');
  }
  
  updateUserBadges();
  loadData();
}

function updateUserBadges() {
  const userBadges = document.getElementById('userBadges');
  userBadges.innerHTML = "";
  
  if (isConjuntaView) {
    const badgeAna = document.createElement("span");
    badgeAna.className = "user-badge ana";
    badgeAna.innerHTML = 'üë© Ana Mar√≠a';
    userBadges.appendChild(badgeAna);
    
    const badgeCamilo = document.createElement("span");
    badgeCamilo.className = "user-badge camilo";
    badgeCamilo.innerHTML = 'üë® Camilo Andr√©s';
    userBadges.appendChild(badgeCamilo);
    
    const badgeConjunto = document.createElement("span");
    badgeConjunto.className = "user-badge conjunto";
    badgeConjunto.innerHTML = 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Gastos Conjuntos';
    userBadges.appendChild(badgeConjunto);
  } else {
    const badge = document.createElement("span");
    badge.className = `user-badge ${currentUser}`;
    badge.innerHTML = currentUser === 'ana' ? 'üë© Ana Mar√≠a' : 
                      currentUser === 'camilo' ? 'üë® Camilo Andr√©s' : 
                      'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Gastos Conjuntos';
    userBadges.appendChild(badge);
  }
}

// ===== C√ÅMARA Y FOTOS =====
async function openCameraModal() {
  document.getElementById('cameraModal').style.display = 'flex';
  document.getElementById('cameraVideo').style.display = 'block';
  document.getElementById('capturedImage').style.display = 'none';
  document.getElementById('photoActions').style.display = 'none';
  
  try {
    cameraStream = await navigator.mediaDevices.getUserMedia({ 
      video: { 
        facingMode: 'environment',
        width: { ideal: 1280 },
        height: { ideal: 720 }
      } 
    });
    document.getElementById('cameraVideo').srcObject = cameraStream;
  } catch (error) {
    console.error("Error accediendo a la c√°mara:", error);
    showNotification("No se pudo acceder a la c√°mara", "error");
    closeCameraModal();
  }
}

function closeCameraModal() {
  document.getElementById('cameraModal').style.display = 'none';
  if (cameraStream) {
    cameraStream.getTracks().forEach(track => track.stop());
    cameraStream = null;
  }
}

function capturePhoto() {
  const video = document.getElementById('cameraVideo');
  const canvas = document.getElementById('cameraCanvas');
  const context = canvas.getContext('2d');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  
  context.drawImage(video, 0, 0, canvas.width, canvas.height);
  
  canvas.toBlob((blob) => {
    currentPhotoBlob = blob;
    const imageUrl = URL.createObjectURL(blob);
    document.getElementById('capturedImage').src = imageUrl;
    document.getElementById('capturedImage').style.display = 'block';
    document.getElementById('cameraVideo').style.display = 'none';
    document.getElementById('photoActions').style.display = 'block';
    
    if (cameraStream) {
      cameraStream.getTracks().forEach(track => track.stop());
      cameraStream = null;
    }
  }, 'image/jpeg', 0.8);
}

function retakePhoto() {
  document.getElementById('capturedImage').style.display = 'none';
  document.getElementById('cameraVideo').style.display = 'block';
  document.getElementById('photoActions').style.display = 'none';
  openCameraModal();
}

function usePhoto() {
  if (currentPhotoBlob) {
    const imageUrl = URL.createObjectURL(currentPhotoBlob);
    document.getElementById('photoPreview').src = imageUrl;
    document.getElementById('photoPreview').style.display = 'block';
    closeCameraModal();
    showNotification("Foto capturada correctamente", 'success');
  }
}

function openPhotoViewer(photoUrl) {
  document.getElementById('fullSizePhoto').src = photoUrl;
  document.getElementById('photoViewer').style.display = 'flex';
}

function closePhotoViewer() {
  document.getElementById('photoViewer').style.display = 'none';
}

// ===== INICIALIZAR APLICACI√ìN =====
function initializeApp() {
  const categoriasIngresos = {
    "Ingresos": ["N√≥mina", "Prima", "Cesant√≠as", "Cadena", "Otros Ingresos"]
  };

  const categoriasGastos = {
    "Servicios": ["Agua", "Energ√≠a", "Gas", "Internet", "Telefon√≠a m√≥vil"],
    "Mercado": ["Carnes", "Frutas", "L√°cteos", "Panader√≠a", "Bebidas", "Snacks"],
    "Transporte": ["Gasolina", "Transporte p√∫blico", "Taxi / Apps", "Moto"],
    "Salud": ["Medicamentos", "Consultas", "Ex√°menes"],
    "Educaci√≥n": ["Matr√≠culas", "Diplomados"],
    "Ocio": ["Cine", "Viajes", "Restaurantes"],
    "Finanzas": ["Tarjetas", "Pr√©stamos", "Ahorro", "Inversiones"],
    "Hogar": ["Arriendo", "Mantenimiento", "Muebles", "Electrodom√©sticos"],
    "Otros": ["No clasificado"]
  };

  const cat1 = document.getElementById("catNivel1");
  const cat2 = document.getElementById("catNivel2");
  const fuenteDinero = document.getElementById("fuenteDinero");
  tipo = "Ingreso";
  
  function cargarCategorias() {
    cat1.innerHTML = '<option value="">Selecciona categor√≠a principal</option>';
    cat2.innerHTML = '<option value="">Selecciona subcategor√≠a</option>';

    const origen = tipo === "Ingreso" ? categoriasIngresos : categoriasGastos;
    Object.keys(origen).forEach(c => {
      cat1.innerHTML += `<option value="${c}">${c}</option>`;
    });

    cat1.onchange = () => {
      cat2.innerHTML = '<option value="">Selecciona subcategor√≠a</option>';
      if (origen[cat1.value]) {
        origen[cat1.value].forEach(s => {
          cat2.innerHTML += `<option value="${s}">${s}</option>`;
        });
      }
    };
  }

  document.getElementById("btnIngreso").onclick = () => {
    tipo = "Ingreso";
    document.getElementById("btnIngreso").classList.add("active");
    document.getElementById("btnGasto").classList.remove("active");
    document.getElementById("photoSection").style.display = "none";
    document.getElementById("fuenteSection").style.display = "none";
    cargarCategorias();
  };

  document.getElementById("btnGasto").onclick = () => {
    tipo = "Gasto";
    document.getElementById("btnGasto").classList.add("active");
    document.getElementById("btnIngreso").classList.remove("active");
    document.getElementById("photoSection").style.display = "block";
    document.getElementById("fuenteSection").style.display = "block";
    cargarCategorias();
  };

  cargarCategorias();

  document.getElementById("formulario").onsubmit = async (e) => {
    e.preventDefault();

    if (!currentUser) {
      showNotification("Debes iniciar sesi√≥n para registrar movimientos", "error");
      return;
    }

    const monto = document.getElementById("monto").value;
    const catNivel1 = cat1.value;
    const catNivel2 = cat2.value;
    const observacion = document.getElementById("observacion").value;
    const fuente = tipo === "Gasto" ? fuenteDinero.value : "";

    if (!monto || monto <= 0) {
      showNotification("Ingresa un monto v√°lido", "error");
      return;
    }
    if (!catNivel1 || !catNivel2) {
      showNotification("Selecciona ambas categor√≠as", "error");
      return;
    }
    if (tipo === "Gasto" && !fuente) {
      showNotification("Selecciona la fuente del dinero", "error");
      return;
    }

    try {
      const movimientoData = {
        tipo,
        monto: Number(monto),
        categoriaNivel1: catNivel1,
        categoriaNivel2: catNivel2,
        observacion: observacion,
        usuario: currentUser,
        usuarioNombre: USER_NAMES[currentUser],
        fecha: firebase.firestore.FieldValue.serverTimestamp(),
        activo: true,
        tieneFoto: false
      };

      if (tipo === "Gasto") {
        movimientoData.fuenteDinero = fuente;
      }

      if (currentPhotoBlob && tipo === "Gasto") {
        const fileName = `facturas/${currentUser}/${Date.now()}.jpg`;
        const storageRef = storage.ref();
        const photoRef = storageRef.child(fileName);
        
        await photoRef.put(currentPhotoBlob);
        const downloadURL = await photoRef.getDownloadURL();
        
        movimientoData.fotoURL = downloadURL;
        movimientoData.tieneFoto = true;
        
        currentPhotoBlob = null;
        document.getElementById('photoPreview').style.display = 'none';
        document.getElementById('photoPreview').src = '';
      }

      await db.collection("movimientos").add(movimientoData);

      showNotification(`${tipo} registrado correctamente: COP ${Number(monto).toLocaleString()}`, 'success');

      document.getElementById("formulario").reset();
      fuenteDinero.value = "";
      cargarCategorias();
      
      if (tipo !== "Gasto") {
        document.getElementById("photoSection").style.display = "none";
        document.getElementById("fuenteSection").style.display = "none";
      }

    } catch (error) {
      console.error("Error al guardar:", error);
      showNotification("Error al guardar el movimiento: " + error.message, "error");
    }
  };

  // Gr√°fico de Resumen Financiero (solo Gastos y Saldo)
  const canvas = document.getElementById("grafico");
  chart = new Chart(canvas, {
    type: "line",
    data: {
      labels: [],
      datasets: [
        { 
          label: "Gastos", 
          data: [], 
          borderColor: "#ff3b30", 
          backgroundColor: "rgba(255, 59, 48, 0.1)",
          borderWidth: 2,
          tension: 0.4,
          fill: true
        },
        { 
          label: "Saldo", 
          data: [], 
          borderColor: "#4189ED", 
          backgroundColor: "rgba(65, 137, 237, 0.1)",
          borderWidth: 2,
          tension: 0.4,
          fill: false,
          type: 'line'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: 'Evoluci√≥n de Gastos y Saldo',
          font: {
            size: 16
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return 'COP ' + value.toLocaleString();
            }
          }
        }
      }
    }
  });

  // Gr√°fico de Distribuci√≥n de Gastos con porcentajes
  const canvasGastos = document.getElementById("graficoGastos");
  chartGastos = new Chart(canvasGastos, {
    type: "pie",
    data: {
      labels: [],
      datasets: [{
        data: [],
        backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#8AC926','#C9CBCF','#1982C4','#6A4C93'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'right',
          labels: {
            generateLabels: function(chart) {
              const data = chart.data;
              if (data.labels.length && data.datasets.length) {
                return data.labels.map((label, i) => {
                  const value = data.datasets[0].data[i];
                  const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                  const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                  return {
                    text: `${label}: ${percentage}%`,
                    fillStyle: data.datasets[0].backgroundColor[i],
                    strokeStyle: data.datasets[0].borderColor ? data.datasets[0].borderColor[i] : data.datasets[0].backgroundColor[i],
                    lineWidth: 1,
                    hidden: false,
                    index: i
                  };
                });
              }
              return [];
            }
          }
        },
        title: {
          display: true,
          text: 'Distribuci√≥n de Gastos por Categor√≠a',
          font: {
            size: 16
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: COP ${value.toLocaleString()} (${percentage}%)`;
            }
          }
        }
      }
    }
  });

  // Gr√°fico de Ingresos Mensuales
  const canvasIngresos = document.getElementById("graficoIngresos");
  chartIngresos = new Chart(canvasIngresos, {
    type: "bar",
    data: {
      labels: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
      datasets: [{
        label: "Ingresos",
        data: [],
        backgroundColor: 'rgba(52, 199, 89, 0.6)',
        borderColor: '#34c759',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        title: {
          display: true,
          text: 'Ingresos Mensuales',
          font: {
            size: 16
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return 'COP ' + value.toLocaleString();
            }
          }
        }
      }
    }
  });

  loadData();
}

// ===== CARGAR DATOS =====
function loadData() {
  if (unsubscribeListener) {
    unsubscribeListener();
  }

  let query;
  
  if (isConjuntaView) {
    query = db.collection("movimientos")
      .where("usuario", "in", ["ana", "camilo", "conjunto"])
      .orderBy("fecha", "desc");
  } else {
    query = db.collection("movimientos")
      .where("usuario", "==", currentUser)
      .orderBy("fecha", "desc");
  }

  unsubscribeListener = query.onSnapshot((snapshot) => {
    allMovements = [];
    snapshot.forEach(doc => {
      allMovements.push({ id: doc.id, ...doc.data() });
    });
    updateSummaryCards(allMovements);
    filterMovements(currentFilter);
  }, (error) => {
    console.error("Error en consulta:", error);
    showNotification("Error al cargar movimientos", "error");
  });
}

// ===== FILTRAR MOVIMIENTOS =====
function filterMovements(filterType) {
  currentFilter = filterType;
  
  const filterButtons = document.querySelectorAll('#movementFilters .filter-btn');
  filterButtons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.classList.contains('debito') && filterType !== 'debito') {
      btn.classList.add('debito');
    }
    if (btn.classList.contains('credito') && filterType !== 'credito') {
      btn.classList.add('credito');
    }
  });
  
  const activeBtn = Array.from(filterButtons).find(btn => 
    (filterType === 'todos' && btn.textContent === 'Todos') ||
    (filterType === 'ingresos' && btn.textContent === 'Ingresos') ||
    (filterType === 'gastos' && btn.textContent === 'Gastos') ||
    (filterType === 'activos' && btn.textContent === 'Activos') ||
    (filterType === 'debito' && btn.textContent === 'D√©bito') ||
    (filterType === 'credito' && btn.textContent === 'Cr√©dito')
  );
  
  if (activeBtn) {
    activeBtn.classList.add('active');
  }
  
  let filteredMovements = allMovements;
  
  switch(filterType) {
    case 'ingresos':
      filteredMovements = allMovements.filter(m => m.tipo === "Ingreso");
      break;
    case 'gastos':
      filteredMovements = allMovements.filter(m => m.tipo === "Gasto");
      break;
    case 'activos':
      filteredMovements = allMovements.filter(m => m.activo !== false);
      break;
    case 'debito':
      filteredMovements = allMovements.filter(m => m.fuenteDinero === "Debito");
      break;
    case 'credito':
      filteredMovements = allMovements.filter(m => m.fuenteDinero === "Credito");
      break;
    case 'todos':
    default:
      filteredMovements = allMovements;
      break;
  }
  
  processMovementsArray(filteredMovements);
}

// ===== ACTUALIZAR TARJETAS DE RESUMEN =====
function updateSummaryCards(movimientos) {
  let totalIngresos = 0;
  let totalGastos = 0;
  let totalDebito = 0;
  let totalCredito = 0;
  let countIngresos = 0;
  let countGastos = 0;
  let countDebito = 0;
  let countCredito = 0;
  
  const map = {};
  const gastosPorCategoria = {};
  const ingresosMensuales = Array(12).fill(0);
  
  movimientos.forEach((movimiento) => {
    const estaActivo = movimiento.activo !== false;
    
    if (estaActivo) {
      if (movimiento.tipo === "Ingreso") {
        totalIngresos += movimiento.monto;
        countIngresos++;
        const fecha = movimiento.fecha && movimiento.fecha.toDate ? movimiento.fecha.toDate() : new Date();
        const mes = fecha.getMonth();
        ingresosMensuales[mes] += movimiento.monto;
      } else if (movimiento.tipo === "Gasto") {
        totalGastos += movimiento.monto;
        countGastos++;
        const catPrincipal = movimiento.categoriaNivel1;
        if (!gastosPorCategoria[catPrincipal]) {
          gastosPorCategoria[catPrincipal] = 0;
        }
        gastosPorCategoria[catPrincipal] += movimiento.monto;
        
        if (movimiento.fuenteDinero === "Debito") {
          totalDebito += movimiento.monto;
          countDebito++;
        } else if (movimiento.fuenteDinero === "Credito") {
          totalCredito += movimiento.monto;
          countCredito++;
        }
      }
      
      let fecha;
      if (movimiento.fecha && movimiento.fecha.toDate) {
        fecha = movimiento.fecha.toDate();
      } else if (movimiento.fecha) {
        fecha = new Date(movimiento.fecha);
      } else {
        fecha = new Date();
      }
      
      const day = fecha.toLocaleDateString('es-ES', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });

      if (!map[day]) {
        map[day] = { g: 0, s: 0 };
      }

      if (movimiento.tipo === "Ingreso") {
        map[day].s += movimiento.monto;
      } else {
        map[day].g += movimiento.monto;
        map[day].s -= movimiento.monto;
      }
    }
  });
  
  document.getElementById("totalIngresos").textContent = `COP ${totalIngresos.toLocaleString()}`;
  document.getElementById("totalGastos").textContent = `COP ${totalGastos.toLocaleString()}`;
  document.getElementById("totalDebito").textContent = `COP ${totalDebito.toLocaleString()}`;
  document.getElementById("totalCredito").textContent = `COP ${totalCredito.toLocaleString()}`;
  
  const saldo = totalIngresos - totalGastos;
  document.getElementById("saldo").textContent = `COP ${saldo.toLocaleString()}`;
  document.getElementById("totalIngresosCount").textContent = `${countIngresos} registros`;
  document.getElementById("totalGastosCount").textContent = `${countGastos} registros`;
  document.getElementById("summaryIngresosCount").textContent = countIngresos;
  document.getElementById("summaryGastosCount").textContent = countGastos;
  document.getElementById("summaryDebitoCount").textContent = countDebito;
  document.getElementById("summaryCreditoCount").textContent = countCredito;
  
  const debitoCard = document.getElementById('debitoCard');
  const creditoCard = document.getElementById('creditoCard');
  
  if (countDebito > 0) {
    debitoCard.style.display = 'block';
  } else {
    debitoCard.style.display = 'none';
  }
  
  if (countCredito > 0) {
    creditoCard.style.display = 'block';
  } else {
    creditoCard.style.display = 'none';
  }
  
  const days = Object.keys(map);
  const sortedDays = days.sort((a, b) => {
    const [dayA, monthA, yearA] = a.split('/').map(Number);
    const [dayB, monthB, yearB] = b.split('/').map(Number);
    const dateA = new Date(yearA, monthA - 1, dayA);
    const dateB = new Date(yearB, monthB - 1, dayB);
    return dateA - dateB;
  });

  chart.data.labels = sortedDays;
  chart.data.datasets[0].data = sortedDays.map(day => map[day].g);
  chart.data.datasets[1].data = sortedDays.map(day => map[day].s);
  chart.update();
  
  const categorias = Object.keys(gastosPorCategoria);
  const montos = Object.values(gastosPorCategoria);
  chartGastos.data.labels = categorias;
  chartGastos.data.datasets[0].data = montos;
  chartGastos.update();
  
  chartIngresos.data.datasets[0].data = ingresosMensuales;
  chartIngresos.update();
}

// ===== PROCESAR Y MOSTRAR MOVIMIENTOS =====
function processMovementsArray(movimientos) {
  const listaMovimientos = document.getElementById("listaMovimientos");
  listaMovimientos.innerHTML = "";

  if (movimientos.length === 0) {
    listaMovimientos.innerHTML = `
      <div style="text-align: center; padding: 48px; color: var(--light-blue);">
        <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
        <h3 style="margin-bottom: 8px;">No hay movimientos</h3>
        <p>No se encontraron movimientos con el filtro aplicado</p>
      </div>
    `;
    return;
  }

  movimientos.forEach((movimiento) => {
    let fecha;
    if (movimiento.fecha && movimiento.fecha.toDate) {
      fecha = movimiento.fecha.toDate();
    } else if (movimiento.fecha) {
      fecha = new Date(movimiento.fecha);
    } else {
      fecha = new Date();
    }
    
    const estaActivo = movimiento.activo !== false;
    const fechaFormateada = fecha.toLocaleDateString('es-ES', {
      day: '2-digit',
      month: 'short',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });

    const li = document.createElement("div");
    li.className = `movement-item ${movimiento.tipo.toLowerCase()} ${!estaActivo ? 'movimiento-eliminado' : ''}`;
    
    let fuenteClass = '';
    let fuenteText = '';
    if (movimiento.tipo === "Gasto" && movimiento.fuenteDinero) {
      fuenteClass = movimiento.fuenteDinero.toLowerCase();
      fuenteText = movimiento.fuenteDinero === "Debito" ? "üí≥ D√©bito" : "üí≥ Cr√©dito";
    }
    
    li.innerHTML = `
      <div class="movement-header">
        <div class="movement-info">
          <h4>${movimiento.categoriaNivel1} ¬∑ ${movimiento.categoriaNivel2}</h4>
          <div class="movement-category">${movimiento.usuarioNombre}</div>
        </div>
        <div class="movement-amount ${movimiento.tipo.toLowerCase()}">
          ${movimiento.tipo === 'Gasto' ? '-' : '+'} COP ${movimiento.monto.toLocaleString()}
        </div>
      </div>
      <div class="movement-details">
        <div class="movement-meta">
          <span class="movement-date">${fechaFormateada}</span>
          ${fuenteText ? `<span class="movement-fuente ${fuenteClass}">${fuenteText}</span>` : ''}
          <span class="movement-user">${movimiento.observacion || "Sin observaciones"}</span>
        </div>
        <div class="movement-actions">
          ${estaActivo ? 
            `<button class="action-icon-btn delete-btn" onclick="toggleMovementActive('${movimiento.id}', true)" title="Eliminar">üóëÔ∏è</button>` : 
            `<button class="action-icon-btn restore-btn" onclick="toggleMovementActive('${movimiento.id}', false)" title="Restaurar">‚Ü©Ô∏è</button>`
          }
          ${movimiento.tieneFoto ? 
            `<button class="action-icon-btn photo-btn-small" onclick="openPhotoViewer('${movimiento.fotoURL}')" title="Ver factura">üì∏</button>` : 
            ''
          }
        </div>
      </div>
    `;
    
    listaMovimientos.appendChild(li);
  });
}

// ===== FUNCIONES PARA MOVIMIENTOS =====
async function toggleMovementActive(movimientoId, estaActivo) {
  try {
    if (estaActivo) {
      await db.collection("movimientos").doc(movimientoId).update({
        activo: false,
        eliminadoEn: firebase.firestore.FieldValue.serverTimestamp()
      });
      showNotification("Movimiento marcado como eliminado", 'success');
    } else {
      await db.collection("movimientos").doc(movimientoId).update({
        activo: true,
        eliminadoEn: null
      });
      showNotification("Movimiento restaurado", 'success');
    }
  } catch (error) {
    console.error("Error al cambiar estado del movimiento:", error);
    showNotification("Error al procesar el movimiento", "error");
  }
}

// ===== FUNCIONES PARA TAREAS PERSONALES =====
function openTareasModal() {
  document.getElementById('tareasModal').style.display = 'flex';
  loadTareas();
}

function closeTareasModal() {
  document.getElementById('tareasModal').style.display = 'none';
  if (unsubscribeTareasListener) {
    unsubscribeTareasListener();
    unsubscribeTareasListener = null;
  }
}

function setUrgency(nivel) {
  tareaUrgencia = nivel;
  document.querySelectorAll('.urgency-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.classList.contains(nivel)) {
      btn.classList.add('active');
    }
  });
}

function setImportance(nivel) {
  tareaImportancia = nivel;
  document.querySelectorAll('.importance-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.classList.contains(nivel)) {
      btn.classList.add('active');
    }
  });
}

function loadTareas() {
  if (unsubscribeTareasListener) {
    unsubscribeTareasListener();
  }
  
  if (currentUser !== 'camilo') return;
  
  const query = db.collection("tareas")
    .where("usuario", "==", "camilo")
    .orderBy("fecha", "desc");
    
  unsubscribeTareasListener = query.onSnapshot((snapshot) => {
    const tareas = [];
    snapshot.forEach(doc => {
      tareas.push({ id: doc.id, ...doc.data() });
    });
    mostrarTareas(tareas);
  }, (error) => {
    console.error("Error cargando tareas:", error);
    showNotification("Error al cargar tareas", "error");
  });
}

function mostrarTareas(tareas) {
  const listaTareas = document.getElementById("listaTareas");
  listaTareas.innerHTML = "";
  
  if (tareas.length === 0) {
    listaTareas.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--light-blue);">
        <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
        <h3 style="margin-bottom: 8px;">No hay tareas registradas</h3>
        <p>Agrega tu primera tarea personal</p>
      </div>
    `;
    return;
  }
  
  tareas.forEach((tarea) => {
    let fecha;
    if (tarea.fecha && tarea.fecha.toDate) {
      fecha = tarea.fecha.toDate();
    } else if (tarea.fecha) {
      fecha = new Date(tarea.fecha);
    } else {
      fecha = new Date();
    }
    
    const fechaFormateada = fecha.toLocaleDateString('es-ES', {
      day: '2-digit',
      month: 'short',
      year: 'numeric'
    });
    
    let fechaCompletada = '';
    if (tarea.completada) {
      let fechaComp;
      if (tarea.fechaCompletado && tarea.fechaCompletado.toDate) {
        fechaComp = tarea.fechaCompletado.toDate();
      } else if (tarea.fechaCompletado) {
        fechaComp = new Date(tarea.fechaCompletado);
      } else {
        fechaComp = new Date();
      }
      fechaCompletada = fechaComp.toLocaleDateString('es-ES', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    const categoriasNombres = {
      laboral: "Laboral",
      estudio: "Estudio",
      ocio: "Ocio",
      diligencias: "Diligencias"
    };
    
    const div = document.createElement("div");
    div.className = `tarea-item ${tarea.completada ? 'completada' : ''}`;
    div.innerHTML = `
      <div class="tarea-header">
        <div class="tarea-info">
          <h4>${tarea.detalle}</h4>
          <div class="tarea-categoria">
            ${categoriasNombres[tarea.categoria] || tarea.categoria}
            <span class="tarea-prioridad prioridad-${tarea.urgencia}">
              ${tarea.urgencia === 'alta' ? '‚ö†Ô∏è Alta' : '‚ö° Media'}
            </span>
            <span class="tarea-prioridad importancia-${tarea.importancia}">
              ${tarea.importancia === 'alta' ? 'üéØ Alta' : 'üéØ Media'}
            </span>
          </div>
        </div>
      </div>
      <div class="tarea-details">
        <div class="tarea-meta">
          <span class="tarea-fecha">Creada: ${fechaFormateada}</span>
          ${tarea.completada ? `<span class="tarea-completada">‚úÖ Completada: ${fechaCompletada}</span>` : ''}
        </div>
        <div class="movement-actions">
          ${!tarea.completada ? 
            `<button class="action-icon-btn" style="background: var(--success)" onclick="marcarTareaCompletada('${tarea.id}')" title="Marcar como completada">‚úì</button>` : 
            ''
          }
          <button class="action-icon-btn delete-btn" onclick="eliminarTarea('${tarea.id}')" title="Eliminar tarea">üóëÔ∏è</button>
        </div>
      </div>
    `;
    listaTareas.appendChild(div);
  });
}

document.getElementById("tareaForm").onsubmit = async (e) => {
  e.preventDefault();
  
  if (currentUser !== 'camilo') {
    showNotification("Solo Camilo puede agregar tareas", "error");
    return;
  }
  
  const detalle = document.getElementById("tareaDetalle").value;
  const categoria = document.getElementById("tareaCategoria").value;
  
  if (!detalle.trim()) {
    showNotification("Ingresa un detalle para la tarea", "error");
    return;
  }
  if (!categoria) {
    showNotification("Selecciona una categor√≠a", "error");
    return;
  }
  
  try {
    const tareaData = {
      detalle: detalle.trim(),
      categoria: categoria,
      urgencia: tareaUrgencia,
      importancia: tareaImportancia,
      usuario: "camilo",
      fecha: firebase.firestore.FieldValue.serverTimestamp(),
      completada: false
    };
    
    await db.collection("tareas").add(tareaData);
    showNotification("Tarea agregada correctamente", 'success');
    document.getElementById("tareaForm").reset();
    document.getElementById('tareaDetalle').focus();
  } catch (error) {
    console.error("Error al guardar tarea:", error);
    showNotification("Error al guardar la tarea: " + error.message, "error");
  }
};

async function marcarTareaCompletada(tareaId) {
  try {
    await db.collection("tareas").doc(tareaId).update({
      completada: true,
      fechaCompletado: firebase.firestore.FieldValue.serverTimestamp()
    });
    showNotification("Tarea marcada como completada", 'success');
  } catch (error) {
    console.error("Error al marcar tarea como completada:", error);
    showNotification("Error al completar la tarea", "error");
  }
}

async function eliminarTarea(tareaId) {
  if (confirm("¬øEst√°s seguro de eliminar esta tarea?")) {
    try {
      await db.collection("tareas").doc(tareaId).delete();
      showNotification("Tarea eliminada correctamente", 'success');
    } catch (error) {
      console.error("Error al eliminar tarea:", error);
      showNotification("Error al eliminar la tarea", "error");
    }
  }
}

// ===== EVENT LISTENERS PARA MODALES =====
document.getElementById('cameraModal').addEventListener('click', function(e) {
  if (e.target === this) closeCameraModal();
});

document.getElementById('photoViewer').addEventListener('click', function(e) {
  if (e.target === this) closePhotoViewer();
});

document.getElementById('tareasModal').addEventListener('click', function(e) {
  if (e.target === this) closeTareasModal();
});
</script>
</body>
</html>
