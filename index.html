<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARSOL Â· Control de Gastos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:#f2f4f8;padding:20px;color:#1c1c1e}
h1{text-align:center;margin-bottom:20px}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:15px;margin-bottom:25px
}
.card{
  border-radius:20px;padding:20px;color:#fff;
  box-shadow:0 10px 25px rgba(0,0,0,.08)
}
.ingreso{background:linear-gradient(135deg,#34c759,#2ecc71)}
.gasto{background:linear-gradient(135deg,#ff3b30,#ff6b6b)}
.saldo{background:linear-gradient(135deg,#007aff,#5ac8fa)}

form{
  background:#fff;border-radius:20px;padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:25px
}

.segmented{display:flex;background:#eee;border-radius:14px;margin-bottom:15px}
.segmented button{
  flex:1;border:none;padding:12px;
  background:none;font-weight:600;cursor:pointer
}
.segmented .active{background:#007aff;color:#fff}

input,select,textarea{
  width:100%;padding:14px;border-radius:14px;
  border:1px solid #ccc;margin-bottom:12px
}

.increment{
  background:#e5f0ff;color:#007aff;
  border:none;padding:10px;border-radius:12px;
  cursor:pointer;font-weight:600;margin-bottom:12px
}

.submit{
  width:100%;padding:14px;
  border:none;border-radius:16px;
  background:linear-gradient(135deg,#007aff,#5ac8fa);
  color:#fff;font-weight:600;font-size:16px
}

canvas{
  background:#fff;border-radius:20px;
  padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:25px
}

ul{list-style:none}
li{
  background:#fff;border-radius:16px;
  padding:15px;margin-bottom:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.06)
}
li.ingreso{border-left:5px solid #34c759}
li.gasto{border-left:5px solid #ff3b30}
small{color:#666}
</style>
</head>

<body>

<h1>MARSOL ðŸ’°</h1>

<div class="dashboard">
  <div class="card ingreso"><span>Ingresos</span><h2 id="totalIngresos">COP 0</h2></div>
  <div class="card gasto"><span>Gastos</span><h2 id="totalGastos">COP 0</h2></div>
  <div class="card saldo"><span>Saldo</span><h2 id="saldo">COP 0</h2></div>
</div>

<form id="formulario">
  <div class="segmented">
    <button type="button" id="btnIngreso" class="active">Ingreso</button>
    <button type="button" id="btnGasto">Gasto</button>
  </div>

  <input type="number" id="monto" placeholder="Monto COP">
  <button type="button" class="increment" id="add100">+ 100.000</button>

  <select id="catNivel1">
    <option value="">CategorÃ­a principal</option>
  </select>

  <select id="catNivel2">
    <option value="">SubcategorÃ­a</option>
  </select>

  <textarea id="observacion" rows="3" placeholder="Observaciones (opcional)"></textarea>

  <button class="submit">Registrar</button>
</form>

<canvas id="grafico"></canvas>

<ul id="listaMovimientos"></ul>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDYD0OBJKdZ14-mvzEpN85M5_glF92WE_g",
  authDomain:"formulario-github.firebaseapp.com",
  projectId:"formulario-github"
});
const db=firebase.firestore();

/* ---------- CATEGORIAS ---------- */
const categorias={
  "Servicios":["Agua","EnergÃ­a","Gas","Internet","TelefonÃ­a"],
  "Mercado":["Carnes","Frutas","LÃ¡cteos","PanaderÃ­a","Bebidas"],
  "Transporte":["Gasolina","Transporte pÃºblico","Taxi","Moto"],
  "Salud":["Medicamentos","Consultas","ExÃ¡menes"],
  "EducaciÃ³n":["MatrÃ­culas","Diplomados"],
  "Ocio":["Cine","Viajes","Restaurantes"],
  "Finanzas":["Tarjetas","PrÃ©stamos","Ahorro"],
  "Otros":["No clasificado"]
};

const cat1=document.getElementById("catNivel1");
const cat2=document.getElementById("catNivel2");

Object.keys(categorias).forEach(c=>{
  cat1.innerHTML+=`<option>${c}</option>`;
});

cat1.onchange=()=>{
  cat2.innerHTML='<option value="">SubcategorÃ­a</option>';
  categorias[cat1.value]?.forEach(s=>{
    cat2.innerHTML+=`<option>${s}</option>`;
  });
};

/* ---------- UI ---------- */
let tipo="Ingreso";
btnIngreso.onclick=()=>{tipo="Ingreso";btnIngreso.classList.add("active");btnGasto.classList.remove("active")}
btnGasto.onclick=()=>{tipo="Gasto";btnGasto.classList.add("active");btnIngreso.classList.remove("active")}
add100.onclick=()=>monto.value=(parseInt(monto.value||0)+100000);

/* ---------- REGISTRO ---------- */
formulario.onsubmit=e=>{
  e.preventDefault();
  db.collection("movimientos").add({
    tipo,
    monto:Number(monto.value),
    categoria1:cat1.value,
    categoria2:cat2.value,
    observacion:observacion.value,
    fecha:new Date()
  });
  formulario.reset();
};

/* ---------- GRAFICO ---------- */
const chart=new Chart(grafico,{
  type:"line",
  data:{labels:[],datasets:[
    {label:"Ingresos",data:[],borderColor:"#34c759"},
    {label:"Gastos",data:[],borderColor:"#ff3b30"}
  ]}
});

/* ---------- CONSULTA ---------- */
db.collection("movimientos").orderBy("fecha","desc")
.onSnapshot(snap=>{
  let ing=0,gas=0;
  const map={};
  listaMovimientos.innerHTML="";

  snap.forEach(d=>{
    const x=d.data();
    const day=new Date(x.fecha.toDate()).toLocaleDateString();
    map[day]=map[day]||{i:0,g:0};

    if(x.tipo==="Ingreso"){ing+=x.monto;map[day].i+=x.monto}
    else{gas+=x.monto;map[day].g+=x.monto}

    listaMovimientos.innerHTML+=`
    <li class="${x.tipo.toLowerCase()}">
      <strong>${x.categoria1} Â· ${x.categoria2}</strong><br>
      COP ${x.monto.toLocaleString()}<br>
      <small>${x.observacion||""}</small>
    </li>`;
  });

  totalIngresos.textContent=`COP ${ing.toLocaleString()}`;
  totalGastos.textContent=`COP ${gas.toLocaleString()}`;
  saldo.textContent=`COP ${(ing-gas).toLocaleString()}`;

  chart.data.labels=Object.keys(map);
  chart.data.datasets[0].data=Object.values(map).map(x=>x.i);
  chart.data.datasets[1].data=Object.values(map).map(x=>x.g);
  chart.update();
});
</script>

</body>
</html>
