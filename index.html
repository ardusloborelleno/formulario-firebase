<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARSOL ¬∑ Cost Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:#f2f4f8;padding:20px;color:#1c1c1e}

/* ---------- VISTAS ---------- */
.screen{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.hidden{display:none}

/* ---------- SPLASH ---------- */
.splash{
  background:linear-gradient(135deg,#0f4c75,#1b9aaa,#5fdde5);
  color:#fff;
}
.splash-content{text-align:center}
.splash-content h1{font-size:48px;font-weight:700}
.splash-content p{font-size:22px;opacity:.9}
.splash-content span{font-size:14px;opacity:.8}

/* ---------- USUARIO ---------- */
.user-card{
  background:#fff;
  padding:30px;
  border-radius:24px;
  width:280px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.user-card h2{margin-bottom:20px}
.user-card button{
  width:100%;
  padding:14px;
  margin-bottom:12px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,#007aff,#5ac8fa);
  color:#fff;
  font-weight:600;
  font-size:16px;
}

/* ---------- FACE ID ---------- */
.faceid-card{
  background:#fff;
  padding:30px;
  border-radius:24px;
  width:260px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.faceid-icon{
  width:60px;
  height:60px;
  margin:0 auto 20px;
  border-radius:18px;
  border:3px solid #007aff;
  position:relative;
}
.faceid-icon::before,
.faceid-icon::after{
  content:"";
  position:absolute;
  inset:10px;
  border:2px solid #007aff;
  border-radius:12px;
}
.faceid-icon::after{
  inset:18px;
  border-radius:8px;
}

/* ---------- APP ---------- */
h1{text-align:center;margin-bottom:20px}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:15px;margin-bottom:25px
}
.card{
  border-radius:20px;padding:20px;color:#fff;
  box-shadow:0 10px 25px rgba(0,0,0,.08)
}
.ingreso{background:linear-gradient(135deg,#34c759,#2ecc71)}
.gasto{background:linear-gradient(135deg,#ff3b30,#ff6b6b)}
.saldo{background:linear-gradient(135deg,#007aff,#5ac8fa)}

form{
  background:#fff;border-radius:20px;padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:25px
}

.segmented{display:flex;background:#eee;border-radius:14px;margin-bottom:15px}
.segmented button{
  flex:1;border:none;padding:12px;
  background:none;font-weight:600;cursor:pointer
}
.segmented .active{background:#007aff;color:#fff}

input,select,textarea{
  width:100%;padding:14px;border-radius:14px;
  border:1px solid #ccc;margin-bottom:12px
}

.increment{
  background:#e5f0ff;color:#007aff;
  border:none;padding:10px;border-radius:12px;
  cursor:pointer;font-weight:600;margin-bottom:12px
}

.submit{
  width:100%;padding:14px;
  border:none;border-radius:16px;
  background:linear-gradient(135deg,#007aff,#5ac8fa);
  color:#fff;font-weight:600;font-size:16px
}

canvas{
  background:#fff;border-radius:20px;
  padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:25px
}

ul{list-style:none}
li{
  background:#fff;border-radius:16px;
  padding:15px;margin-bottom:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.06)
}
li.ingreso{border-left:5px solid #34c759}
li.gasto{border-left:5px solid #ff3b30}
small{color:#666}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash" class="screen splash">
  <div class="splash-content">
    <h1>MarSol</h1>
    <p>Cost Control</p>
    <span>Version 1.0 ¬∑ 2026</span>
  </div>
</div>

<!-- SELECCI√ìN USUARIO -->
<div id="userSelect" class="screen hidden">
  <div class="user-card">
    <h2>Selecciona tu perfil</h2>
    <button onclick="selectUser('Ana Maria')">Ana Mar√≠a</button>
    <button onclick="selectUser('Camilo Andres')">Camilo Andr√©s</button>
  </div>
</div>

<!-- FACE ID -->
<div id="faceID" class="screen hidden">
  <div class="faceid-card">
    <div class="faceid-icon"></div>
    <h2>Face ID</h2>
    <p>Confirma tu identidad</p>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<h1>MARSOL üí∞</h1>

<div class="dashboard">
  <div class="card ingreso"><span>Ingresos</span><h2 id="totalIngresos">COP 0</h2></div>
  <div class="card gasto"><span>Gastos</span><h2 id="totalGastos">COP 0</h2></div>
  <div class="card saldo"><span>Saldo</span><h2 id="saldo">COP 0</h2></div>
</div>

<form id="formulario">
  <div class="segmented">
    <button type="button" id="btnIngreso" class="active">Ingreso</button>
    <button type="button" id="btnGasto">Gasto</button>
  </div>

  <input type="number" id="monto" placeholder="Monto COP" required>
  <button type="button" class="increment" id="add100">+ 100.000</button>

  <select id="catNivel1" required>
    <option value="">Categor√≠a principal</option>
  </select>

  <select id="catNivel2" required>
    <option value="">Subcategor√≠a</option>
  </select>

  <textarea id="observacion" rows="3" placeholder="Observaciones (opcional)"></textarea>

  <button class="submit">Registrar</button>
</form>

<canvas id="grafico"></canvas>
<ul id="listaMovimientos"></ul>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDYD0OBJKdZ14-mvzEpN85M5_glF92WE_g",
  authDomain:"formulario-github.firebaseapp.com",
  projectId:"formulario-github"
});
const db=firebase.firestore();

/* ---------- VISTAS ---------- */
const splash=document.getElementById("splash");
const userSelect=document.getElementById("userSelect");
const faceID=document.getElementById("faceID");
const app=document.getElementById("app");

/* ---------- SPLASH ---------- */
setTimeout(()=>{
  splash.classList.add("hidden");
  userSelect.classList.remove("hidden");
},1500);

/* ---------- FACE ID (UX iOS) ---------- */
function selectUser(user){
  userSelect.classList.add("hidden");
  faceID.classList.remove("hidden");

  setTimeout(()=>{
    localStorage.setItem("usuarioActivo",user);
    faceID.classList.add("hidden");
    app.classList.remove("hidden");
  },1200);
}

/* ---------- CATEGOR√çAS ---------- */
const categoriasIngresos={"Ingresos":["N√≥mina","Prima","Cesant√≠as","Cadena"]};
const categoriasGastos={
  "Servicios":["Agua","Energ√≠a","Gas","Internet","Telefon√≠a m√≥vil"],
  "Mercado":["Carnes","Frutas","L√°cteos","Panader√≠a","Bebidas","Snacks"],
  "Transporte":["Gasolina","Transporte p√∫blico","Taxi / Apps","Moto"],
  "Salud":["Medicamentos","Consultas","Ex√°menes"],
  "Educaci√≥n":["Matr√≠culas","Diplomados"],
  "Ocio":["Cine","Viajes","Restaurantes"],
  "Finanzas":["Tarjetas","Pr√©stamos","Ahorro","Inversiones"],
  "Otros":["No clasificado"]
};

let tipo="Ingreso";
const cat1=catNivel1,cat2=catNivel2;

function cargarCategorias(){
  cat1.innerHTML='<option value="">Categor√≠a principal</option>';
  cat2.innerHTML='<option value="">Subcategor√≠a</option>';
  const origen=tipo==="Ingreso"?categoriasIngresos:categoriasGastos;
  Object.keys(origen).forEach(c=>cat1.innerHTML+=`<option>${c}</option>`);
  cat1.onchange=()=>{
    cat2.innerHTML='<option value="">Subcategor√≠a</option>';
    origen[cat1.value]?.forEach(s=>cat2.innerHTML+=`<option>${s}</option>`);
  };
}

btnIngreso.onclick=()=>{tipo="Ingreso";btnIngreso.classList.add("active");btnGasto.classList.remove("active");cargarCategorias();}
btnGasto.onclick=()=>{tipo="Gasto";btnGasto.classList.add("active");btnIngreso.classList.remove("active");cargarCategorias();}
add100.onclick=()=>monto.value=(+monto.value||0)+100000;
cargarCategorias();

/* ---------- REGISTRO ---------- */
formulario.onsubmit=e=>{
  e.preventDefault();
  db.collection("movimientos").add({
    usuario:localStorage.getItem("usuarioActivo"),
    tipo,
    monto:+monto.value,
    categoriaNivel1:cat1.value,
    categoriaNivel2:cat2.value,
    observacion:observacion.value,
    fecha:new Date()
  });
  formulario.reset();
  cargarCategorias();
};

/* ---------- GR√ÅFICO ---------- */
const chart=new Chart(grafico,{
  type:"line",
  data:{labels:[],datasets:[
    {label:"Ingresos",data:[],borderColor:"#34c759",tension:.4},
    {label:"Gastos",data:[],borderColor:"#ff3b30",tension:.4}
  ]}
});

/* ---------- CONSULTA ---------- */
db.collection("movimientos").orderBy("fecha","desc").onSnapshot(snap=>{
  let ing=0,gas=0,map={};
  listaMovimientos.innerHTML="";
  snap.forEach(d=>{
    const x=d.data();
    if(x.usuario!==localStorage.getItem("usuarioActivo")) return;
    const day=new Date(x.fecha.toDate()).toLocaleDateString();
    map[day]=map[day]||{i:0,g:0};
    if(x.tipo==="Ingreso"){ing+=x.monto;map[day].i+=x.monto}
    else{gas+=x.monto;map[day].g+=x.monto}
    listaMovimientos.innerHTML+=`
      <li class="${x.tipo.toLowerCase()}">
        <strong>${x.categoriaNivel1} ¬∑ ${x.categoriaNivel2}</strong><br>
        COP ${x.monto.toLocaleString()}<br>
        <small>${x.observacion||""}</small>
      </li>`;
  });
  totalIngresos.textContent=`COP ${ing.toLocaleString()}`;
  totalGastos.textContent=`COP ${gas.toLocaleString()}`;
  saldo.textContent=`COP ${(ing-gas).toLocaleString()}`;
  chart.data.labels=Object.keys(map).reverse();
  chart.data.datasets[0].data=Object.values(map).map(x=>x.i).reverse();
  chart.data.datasets[1].data=Object.values(map).map(x=>x.g).reverse();
  chart.update();
});
</script>

</body>
</html>
