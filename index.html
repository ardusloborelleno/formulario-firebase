<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARSOL Â· Control de Gastos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}

body{
  background:linear-gradient(180deg,#f2f4f8,#ffffff);
  padding:20px;
  color:#1c1c1e;
}

/* ---------- TITULO ---------- */
h1{
  text-align:center;
  margin-bottom:25px;
  font-weight:700;
}

/* ---------- DASHBOARD ---------- */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:15px;
  margin-bottom:30px;
}

.card{
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  color:#fff;
}

.card.ingreso{background:linear-gradient(135deg,#34c759,#2ecc71)}
.card.gasto{background:linear-gradient(135deg,#ff3b30,#ff6b6b)}
.card.saldo{background:linear-gradient(135deg,#007aff,#5ac8fa)}

.card span{
  font-size:13px;
  opacity:.9;
}
.card h2{
  margin-top:10px;
  font-size:22px;
}

/* ---------- FORMULARIO ---------- */
form{
  background:#fff;
  border-radius:22px;
  padding:25px;
  box-shadow:0 15px 30px rgba(0,0,0,.08);
  margin-bottom:30px;
}

.segmented{
  display:flex;
  background:#f2f2f7;
  border-radius:14px;
  overflow:hidden;
  margin-bottom:20px;
}

.segmented button{
  flex:1;
  padding:12px;
  border:none;
  background:none;
  font-weight:600;
  cursor:pointer;
}

.segmented button.active{
  background:#007aff;
  color:#fff;
}

.field{
  margin-bottom:15px;
}

input,textarea{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:15px;
}

textarea{resize:none}

.increment{
  margin-top:10px;
  background:#e5f0ff;
  color:#007aff;
  border:none;
  padding:10px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
}

.submit{
  width:100%;
  margin-top:15px;
  background:linear-gradient(135deg,#007aff,#5ac8fa);
  color:#fff;
  border:none;
  padding:14px;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

/* ---------- AUTOCOMPLETE ---------- */
.autocomplete{
  position:relative;
}
.autocomplete-list{
  position:absolute;
  background:#fff;
  width:100%;
  max-height:180px;
  overflow:auto;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  z-index:10;
}
.autocomplete-item{
  padding:10px;
  cursor:pointer;
}
.autocomplete-item:hover{
  background:#f2f2f7;
}

/* ---------- GRAFICO ---------- */
canvas{
  background:#fff;
  border-radius:20px;
  padding:20px;
  box-shadow:0 15px 30px rgba(0,0,0,.08);
  margin-bottom:30px;
}

/* ---------- HISTORICO ---------- */
ul{list-style:none}
li{
  background:#fff;
  border-radius:16px;
  padding:15px;
  margin-bottom:10px;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}
li.ingreso{border-left:5px solid #34c759}
li.gasto{border-left:5px solid #ff3b30}

small{color:#666}
</style>
</head>

<body>

<h1>MARSOL ðŸ’°</h1>

<div class="dashboard">
  <div class="card ingreso"><span>Ingresos</span><h2 id="totalIngresos">COP 0</h2></div>
  <div class="card gasto"><span>Gastos</span><h2 id="totalGastos">COP 0</h2></div>
  <div class="card saldo"><span>Saldo</span><h2 id="saldo">COP 0</h2></div>
</div>

<form id="formulario">

  <div class="segmented">
    <button type="button" id="btnIngreso" class="active">Ingreso</button>
    <button type="button" id="btnGasto">Gasto</button>
  </div>

  <div class="field">
    <input type="number" id="monto" placeholder="Monto COP">
    <button type="button" class="increment" id="add100">+ 100.000</button>
  </div>

  <div class="field autocomplete">
    <input type="text" id="categoria" placeholder="CategorÃ­a">
    <div class="autocomplete-list" id="listaCategorias"></div>
  </div>

  <div class="field">
    <textarea id="observacion" rows="3" placeholder="Observaciones (opcional)"></textarea>
  </div>

  <button class="submit">Registrar movimiento</button>
</form>

<canvas id="grafico"></canvas>

<ul id="listaMovimientos"></ul>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDYD0OBJKdZ14-mvzEpN85M5_glF92WE_g",
  authDomain:"formulario-github.firebaseapp.com",
  projectId:"formulario-github"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* ---------- CATEGORIAS ---------- */
const categorias=[
"Arriendo","Cuota apartamento","EnergÃ­a elÃ©ctrica","Agua","Gas","Internet",
"Carnes y proteÃ­nas","Mercado mensual","Frutas y verduras","LÃ¡cteos","PanaderÃ­a",
"Bebidas","Snacks","Comidas fuera","Gasolina","Transporte pÃºblico","Taxi / apps",
"Ropa","Calzado","Aseo personal","Medicamentos","Consultas mÃ©dicas",
"EducaciÃ³n","Cine","Viajes","Restaurantes","Tarjetas de crÃ©dito",
"Ahorro","Inversiones","Gastos no clasificados"
];

const inputCat=document.getElementById("categoria");
const listCat=document.getElementById("listaCategorias");

inputCat.addEventListener("input",()=>{
  listCat.innerHTML="";
  categorias.filter(c=>c.toLowerCase().includes(inputCat.value.toLowerCase()))
  .forEach(c=>{
    const div=document.createElement("div");
    div.className="autocomplete-item";
    div.textContent=c;
    div.onclick=()=>{inputCat.value=c;listCat.innerHTML="";}
    listCat.appendChild(div);
  });
});

/* ---------- MONTO ---------- */
document.getElementById("add100").onclick=()=>{
  const m=document.getElementById("monto");
  m.value=(parseInt(m.value||0)+100000);
};

/* ---------- INGRESO / GASTO ---------- */
let tipo="Ingreso";
btnIngreso.onclick=()=>{tipo="Ingreso";btnIngreso.classList.add("active");btnGasto.classList.remove("active")}
btnGasto.onclick=()=>{tipo="Gasto";btnGasto.classList.add("active");btnIngreso.classList.remove("active")}

/* ---------- REGISTRO ---------- */
formulario.onsubmit=e=>{
  e.preventDefault();
  db.collection("movimientos").add({
    tipo,
    monto:parseInt(monto.value),
    categoria:categoria.value,
    observacion:observacion.value,
    fecha:new Date()
  });
  formulario.reset();
}

/* ---------- GRAFICO ---------- */
const ctx=document.getElementById("grafico");
const chart=new Chart(ctx,{
  type:"line",
  data:{labels:[],datasets:[
    {label:"Ingresos",data:[],borderColor:"#34c759"},
    {label:"Gastos",data:[],borderColor:"#ff3b30"}
  ]},
  options:{responsive:true}
});

/* ---------- CONSULTA ---------- */
db.collection("movimientos").orderBy("fecha","desc")
.onSnapshot(snap=>{
  let ing=0,gas=0;
  let map={};
  listaMovimientos.innerHTML="";

  snap.forEach(d=>{
    const x=d.data();
    const day=new Date(x.fecha.toDate()).toLocaleDateString();
    map[day]=map[day]||{i:0,g:0};
    x.tipo==="Ingreso"?map[day].i+=x.monto:map[day].g+=x.monto;

    if(x.tipo==="Ingreso")ing+=x.monto; else gas+=x.monto;

    listaMovimientos.innerHTML+=`
    <li class="${x.tipo.toLowerCase()}">
      <strong>${x.tipo} Â· ${x.categoria}</strong><br>
      COP ${x.monto.toLocaleString()}<br>
      <small>${x.observacion||""}</small>
    </li>`;
  });

  totalIngresos.textContent=`COP ${ing.toLocaleString()}`;
  totalGastos.textContent=`COP ${gas.toLocaleString()}`;
  saldo.textContent=`COP ${(ing-gas).toLocaleString()}`;

  chart.data.labels=Object.keys(map);
  chart.data.datasets[0].data=Object.values(map).map(x=>x.i);
  chart.data.datasets[1].data=Object.values(map).map(x=>x.g);
  chart.update();
});
</script>

</body>
</html>
